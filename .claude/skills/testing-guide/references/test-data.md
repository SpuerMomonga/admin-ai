# 测试数据管理

## 目标

- 测试数据最小化、可读、可复用
- 支持并行执行与可重复运行
- 避免泄露或复用真实敏感数据

## 数据组织策略

- **工厂/构建器优先**：用代码生成最小可用对象，按需覆盖字段
- **fixture 适度复用**：仅复用稳定且通用的“基础对象”，避免一套 fixture 绑死所有用例
- **种子数据可追踪**：需要共享 seed 时，保持小而明确，并记录用途与依赖关系

## 数据隔离与清理

- 单元测试：禁止依赖外部共享状态；如使用全局容器，需每用例 reset
- 集成测试：
  - 优先事务回滚或独立 schema
  - 确保每用例结束后无残留数据（包括缓存与队列）

## 时间、随机数与 ID

- 使用可注入的 `Clock` / `Random` / `IdGenerator`
- 必要时固定种子与当前时间，避免“偶发失败”

## 敏感数据与脱敏

- 禁止在测试中使用真实用户/订单/密钥等数据
- 若需要近似数据：
  - 使用生成器（假名、假邮箱、假卡号格式但不可用）
  - 保持与生产约束一致（长度、格式、唯一性）

## 数据模板建议

- `factories/`：对象工厂（UserFactory、OrderFactory）
- `fixtures/`：通用夹具（最小用户、最小组织）
- `seeds/`：少量共享种子（仅用于集成测试启动）
